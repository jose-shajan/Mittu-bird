<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Mobile</title>
<style>
  body {
    margin: 0;
    background: #70c5ce;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  canvas { display: block; touch-action: none; }
  #gameOverOverlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.6);
    color: #fff;
    text-align: center;
    padding: 20px;
    border-radius: 10px;
    visibility: hidden;
    font-family: Arial, sans-serif;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="gameOverOverlay">
  <p id="gameOverTitle">GAME OVER</p>
  <p id="gameOverScore">Score: 0</p>
  <p id="gameOverHigh">High Score: 0</p>
  <p>Tap / Click to Restart</p>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const overlay = document.getElementById("gameOverOverlay");
const scoreText = document.getElementById("gameOverScore");
const highText = document.getElementById("gameOverHigh");

const GAME_WIDTH = 288;
const GAME_HEIGHT = 512;
canvas.width = GAME_WIDTH;
canvas.height = GAME_HEIGHT;

// Mobile scaling
function resizeCanvas() {
  const scaleX = window.innerWidth / GAME_WIDTH;
  const scaleY = window.innerHeight / GAME_HEIGHT;
  const scale = Math.min(scaleX, scaleY);
  canvas.style.width = GAME_WIDTH * scale + "px";
  canvas.style.height = GAME_HEIGHT * scale + "px";
  ctx.setTransform(scale, 0, 0, scale, 0, 0);
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// Game variables
let score = 0;
let highScore = localStorage.getItem("flappyHighScore") || 0;
let running = false;
let gameOver = false;
const groundHeight = 112;

// Assets
const bg = new Image(); bg.src = "img/bg.png";
const ground = new Image(); ground.src = "img/ground.png";
const birdFrames = [new Image(), new Image(), new Image()];
birdFrames[0].src = "img/bird1.png";
birdFrames[1].src = "img/bird2.png";
birdFrames[2].src = "img/bird3.png";
const pipeTop = new Image(); pipeTop.src = "img/pipe.png";
const pipeBottom = new Image(); pipeBottom.src = "img/pipe.png";

// Sounds
const flapSound = new Audio("sounds/gawwk.mp3");
const hitSound = new Audio("sounds/0919.mp3");

// Wait for assets
let assetsLoaded = 0;
const totalAssets = 9;
function assetLoaded() {
  assetsLoaded++;
  if (assetsLoaded === totalAssets) requestAnimationFrame(loop);
}
[bg, ground, pipeTop, pipeBottom, ...birdFrames].forEach(img => img.onload = assetLoaded);
[flapSound, hitSound].forEach(audio => audio.oncanplaythrough = assetLoaded);

// Bird (level, smooth wing animation)
const bird = {
  x: 50, y: 200, w: 34, h: 24,
  frame: 0, frameTimer: 0, frameInterval: 0.1,
  velocity: 0, gravity: 0.38, jump: 3.8, alive: false, // updated numbers
  draw() { ctx.drawImage(birdFrames[this.frame], this.x, this.y, this.w, this.h); },
  flap() {
    if(!running && !gameOver) running = true;
    this.velocity = -this.jump;
    this.alive = true;
    try { flapSound.currentTime = 0; flapSound.play(); } catch(e) {}
  },
  update(deltaTime) {
    this.frameTimer += deltaTime;
    if(this.frameTimer >= this.frameInterval) {
      this.frame = (this.frame + 1) % birdFrames.length;
      this.frameTimer = 0;
    }
    if (!this.alive) return;
    this.velocity += this.gravity * deltaTime * 60;
    this.y += this.velocity * deltaTime * 60;

    if (this.y + this.h >= GAME_HEIGHT - groundHeight) {
      this.y = GAME_HEIGHT - groundHeight - this.h;
      triggerGameOver();
    }
    if (this.y < 0) this.y = 0;
  }
};

// Pipes
const pipes = [];
const pipeGap = 95; // slightly smaller gap for challenge
const pipeWidth = 52;
let pipeTimer = 0;

function spawnPipe() { 
  pipes.push({ x: GAME_WIDTH, y: -Math.random()*100-50, scored: false }); 
}

function drawPipes() { 
  pipes.forEach(p => { 
    ctx.drawImage(pipeTop, p.x, p.y); 
    ctx.drawImage(pipeBottom, p.x, p.y + pipeTop.height + pipeGap); 
  }); 
}

function updatePipes(deltaTime) {
  if (!bird.alive) return;
  pipes.forEach(p => {
    p.x -= 3.2 * deltaTime * 60; // faster pipes
    if (!p.scored && p.x + pipeWidth < bird.x) {
      score++;
      p.scored = true;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem("flappyHighScore", highScore);
      }
    }
    if (
      bird.x + bird.w > p.x &&
      bird.x < p.x + pipeWidth &&
      (bird.y < p.y + pipeTop.height || bird.y + bird.h > p.y + pipeTop.height + pipeGap)
    ) {
      triggerGameOver();
    }
  });

  if(running) {
    pipeTimer += deltaTime;
    if(pipeTimer >= 1.25) { // shorter interval
      spawnPipe();
      pipeTimer = 0;
    }
  }
}

// Ground (parallax scroll)
let groundX = 0;
function drawGround(deltaTime) {
  if(running) groundX -= 3.5 * deltaTime * 60; // faster than pipes
  if(groundX <= -ground.width) groundX = 0;
  ctx.drawImage(ground, groundX, GAME_HEIGHT - ground.height);
  ctx.drawImage(ground, groundX + ground.width, GAME_HEIGHT - ground.height);
}

// Game Over
function triggerGameOver() {
  if (gameOver) return;
  running = false;
  bird.alive = false;
  gameOver = true;
  try { hitSound.currentTime = 0; hitSound.play(); } catch(e) {}
  scoreText.textContent = "Score: " + score;
  highText.textContent = "High Score: " + highScore;
  overlay.style.visibility = "visible";
}

function resetGame() {
  score = 0;
  pipes.length = 0;
  bird.x = 50; bird.y = 200;
  bird.velocity = 0; bird.alive = false;
  running = false; gameOver = false;
  overlay.style.visibility = "hidden";
  lastTime = 0; frames = 0;
}

// Main loop
let lastTime = 0;
let frames = 0;
function loop(time) {
  const deltaTime = (time - lastTime) / 1000 || 0;
  lastTime = time;

  ctx.drawImage(bg, 0, 0);
  updatePipes(deltaTime);
  drawPipes();
  drawGround(deltaTime);
  bird.update(deltaTime);
  bird.draw();

  ctx.fillStyle = "white";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 10, 25);
  ctx.fillText("High: " + highScore, 10, 50);

  frames++;
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// Controls
document.addEventListener("keydown", e => { if(e.code === "Space") bird.flap(); });
canvas.addEventListener("mousedown", () => { gameOver ? resetGame() : bird.flap(); });
canvas.addEventListener("touchstart", e => { 
  e.preventDefault(); 
  gameOver ? resetGame() : bird.flap(); 
}, {passive:false});
</script>
</body>
</html>



